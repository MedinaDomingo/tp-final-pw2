<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partida en curso</title>
    <link href="https://emoji-css.afeld.me/emoji.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="/public/css/lobby.css">
    <link rel="stylesheet" href="/public/css/nav.css">
    <link rel="stylesheet" href="/public/css/partida.css">
    <link rel="stylesheet" href="/public/fontawesome/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<h1 class="text-center">Partida en curso...</h1>
<section class="container">
    <section class="row rounded-5" style="background-color: #8486d9">
        <section class="col-md-2 d-flex align-items-center text-center">
            <div id="perfil">
                <!-- Mostrar la imagen de perfil, puntuación máxima y número en el ranking -->

                <img src="{{usuario.foto_perfil}}" alt="Imagen de perfil">
                <p>Puntuación Máxima: {{puntuacionMaxima}}</p>
                <p>Número en el Ranking: {{numeroRanking}}</p>

                <!-- Botón para utilizar la trampita -->
                <div class="button-group  mt-3 mb-3 pl-2">
                    <a class="btn fs-2 text-white fw-semibold col-12 rounded-4" style="background-color: #d5d048"
                       id="utilizarTrampita">Utilizar Trampita</a>
                </div>

            </div>
        </section>
        <section class="col-md-8">

            <div class="p-5" id="pregunta">
                <h2 class="text-center">Categoria: {{categoria}}</h2>
                <h3 class="text-center" id="pregunta-enviar">{{pregunta}}</h3>

                <ul id="opciones">

                    <!--Opcion A-->
                    <div class="button-group  mt-3 mb-3">
                        <a class="btn fs-2 text-white fw-semibold col-12 rounded-4" style="background:#6742FA"
                           id="opcionA">{{opcion_a}}</a>
                    </div>
                    <!--Opcion B-->
                    <div class="button-group  mt-3 mb-3">
                        <a class="btn fs-2 text-white fw-semibold col-12 rounded-4" style="background:#6742FA"
                           id="opcionB">{{opcion_b}}</a>
                    </div>
                    <!--Opcion C-->
                    <div class="button-group  mt-3 mb-3">
                        <a class="btn fs-2 text-white fw-semibold col-12 rounded-4" style="background:#6742FA"
                           id="opcionC">{{opcion_c}}</a>
                    </div>
                    <!--Opcion D-->
                    <div class="button-group mt-3 mb-3">
                        <a class="btn fs-2 text-white fw-semibold col-12 rounded-4" style="background:#6742FA"
                           id="opcionD">{{opcion_d}}</a>
                    </div>
                </ul>
                <div class="button-group  mt-1 mb-1 text-center">
                    <a class="btn fs-5 text-white fw-1 col-4 rounded-3 " style="background: #832223"
                       id="reportarPregunta">Reportar pregunta</a>
                </div>

            </div>

        </section>
        <section class="col-md-2 d-flex align-items-center text-center">
            <div id="resultado-incorrecto">

                <div class="button-group  mt-2 mb-2 pr-2">
                    <a class="btn fs-2 text-white fw-semibold col-12 rounded-4" style="background-color: #d54050"
                       id="finalizarPartida">Finalizar partida</a>
                </div>

            </div>
        </section>
    </section>
</section>

<script>
    $(document).ready(function() {
        // Función para manejar la selección de una respuesta por el usuario
        function seleccionarRespuesta(respuesta, pregunta) {
            // Enviar la respuesta seleccionada al servidor para su verificación
            $.ajax({
                type: 'POST',
                url: '/Partida/verificarRespuesta',
                data: {
                    respuesta: respuesta,
                    pregunta: pregunta
                },
                success: function(response) {
                    console.log(response);
                    if (response === 'correcta') {
                        // La respuesta es correcta, cargar una nueva pregunta

                        cargarNuevaPregunta();
                    } else if (response === 'incorrecta') {
                        // La respuesta es incorrecta, redirigir al lobby
                        console.log("false");
                        redirigirAlLobby();
                    }
                },
                error: function() {
                    // Manejar el error en caso de fallo en la solicitud AJAX
                    console.log('Error al verificar la respuesta.');
                }
            });
        }

        // Función para cargar una nueva pregunta en la vista de partida
        function cargarNuevaPregunta() {

            $.ajax({
                type: 'GET',
                url: '/Partida/preguntaAleatoria',
                success: function(data) {
                    console.log(data)
                    data = $.parseJSON(data)
                    // Actualizar la vista con la nueva pregunta y opciones de respuesta
                    $('#pregunta-enviar').text(data.pregunta);
                    $('#categoria').text('Categoría: ' + data.categoria);
                    $('#opcionA').text(data.opcion_a);
                    $('#opcionB').text(data.opcion_b);
                    $('#opcionC').text(data.opcion_c);
                    $('#opcionD').text(data.opcion_d);
                },
                error: function() {
                    console.log('Error al obtener una nueva pregunta.');
                }
            });
        }

        // Función para redirigir al usuario al lobby
        function redirigirAlLobby() {
            window.location.href = '/lobby';
        }

        // Manejar el evento de clic en las opciones de respuesta
        $('#opcionA').on('click', function() {
            let pregunta = $('#pregunta-enviar').text();
            let opcionA = $('#opcionA').text();
            seleccionarRespuesta(opcionA, pregunta);
        });

        $('#opcionB').on('click', function() {
            let pregunta = $('#pregunta-enviar').text();
            let opcionB = $('#opcionB').text();
            seleccionarRespuesta(opcionB, pregunta);
        });

        $('#opcionC').on('click', function() {
            let pregunta = $('#pregunta-enviar').text();
            let opcionC = $('#opcionC').text();
            seleccionarRespuesta(opcionC, pregunta);
        });

        $('#opcionD').on('click', function() {
            let pregunta = $('#pregunta-enviar').text();
            let opcionD = $('#opcionD').text();
            seleccionarRespuesta(opcionD, pregunta);
        });
    });
</script>

</body>
</html>